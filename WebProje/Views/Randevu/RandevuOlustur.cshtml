@model WebProje.Models.Randevu

<div class="container py-5">
    <h2>Randevu Oluştur</h2>
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }
    <div class="row">
        <div class="col-md-6">
            <form asp-action="RandevuOlustur" method="post">
                <div class="mb-3">
                    <label for="Calisan" class="form-label">Çalışan</label>
                    <select class="form-select" id="Calisan" name="CalisanId" required>
                        <option value="">Seçiniz</option>
                        @foreach (var calisan in ViewBag.Calisanlar)
                        {
                            <option value="@calisan.Id">@calisan.Ad @calisan.Soyad</option>
                        }
                    </select>
                </div>
                <div class="mb-3">
                    <label for="Islem" class="form-label">İşlem</label>
                    <select class="form-select" id="Islem" name="IslemId" required>
                        <option value="">Seçiniz</option>
                        @foreach (var islem in ViewBag.Islemler)
                        {
                            <option value="@islem.Id">@islem.Ad (@islem.Ucret ₺, @islem.Sure dakika)</option>
                        }
                    </select>
                </div>
                <div class="mb-3">
                    <label for="Tarih" class="form-label">Tarih</label>
                    <input type="date" class="form-control" id="Tarih" name="Tarih" min="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                    <button type="button" class="btn btn-info mt-2" onclick="SetToday()">Bugün</button>
                    <button type="button" class="btn btn-info mt-2" onclick="SetTomorrow()">Yarın</button>
                </div>
                <div class="mb-3">
                    <label for="Saat" class="form-label">Saat</label>
                    <input type="time" class="form-control" id="Saat" name="Saat" min="@ViewBag.AcilisSaati" max="@ViewBag.KapanisSaati" required />
                </div>
                <button type="submit" class="btn btn-primary" onclick="return confirm('Randevu oluşturmak istediğinizden emin misiniz?');">Randevu Oluştur</button>
            </form>
        </div>
        <div class="col-md-6">
            <h4>Çalışan Bilgileri</h4>
            <div class="card p-3">
                <img id="calisanFoto" src="/uploads/default-profile.png" alt="Çalışan Fotoğrafı" class="img-fluid rounded-circle mb-3" style="width: 100px; height: 100px;">
                <p><strong>Ad Soyad:</strong> <span id="calisanAdSoyad">Belirtilmemiş</span></p>
                <p><strong>Telefon:</strong> <span id="calisanTelefon">Belirtilmemiş</span></p>
                <p><strong>Uzmanlık Alanları:</strong> <span id="calisanUzmanlik">Belirtilmemiş</span></p>
                <p><strong>Adres:</strong> <span id="calisanAdres">Belirtilmemiş</span></p>
            </div>
            <div class="mt-4">
                <p><strong>Güncel Tarih:</strong> @DateTime.Now.ToString("dd.MM.yyyy")</p>
                <p><strong>Güncel Saat:</strong> @DateTime.Now.ToString("HH:mm")</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function SetToday() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('Tarih').value = today;
        }

        function SetTomorrow() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('Tarih').value = tomorrow.toISOString().split('T')[0];
        }

        $(document).ready(function () {
            $('#Calisan').change(function () {
                var calisanId = $(this).val();
                if (calisanId) {
                    $.ajax({
                        url: '/Randevu/GetCalisanDetails',
                        type: 'GET',
                        data: { id: calisanId },
                        success: function (data) {
                            if (data) {
                                $('#calisanAdSoyad').text(data.adSoyad);
                                $('#calisanTelefon').text(data.telefon);
                                $('#calisanUzmanlik').text(data.uzmanlikAlanlari);
                                $('#calisanAdres').text(data.adres);
                                $('#calisanFoto').attr('src', data.profilFotoPath);
                            }
                        },
                        error: function (error) {
                            console.log('Hata:', error);
                        }
                    });
                } else {
                    $('#calisanAdSoyad').text('Belirtilmemiş');
                    $('#calisanTelefon').text('Belirtilmemiş');
                    $('#calisanUzmanlik').text('Belirtilmemiş');
                    $('#calisanAdres').text('Belirtilmemiş');
                    $('#calisanFoto').attr('src', '/uploads/default-profile.png');
                }
            });
        });
    </script>
}
